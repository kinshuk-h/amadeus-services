{% extends "base.html.jinja" %}

{% block css_block %}
    <link rel="stylesheet" href="/static/css/style.flights.css">
{% endblock css_block %}

{% block flights_block %}
    <article class="container block">
        <section class="notification is-info is-light">
            <div class="field is-grouped is-grouped-multiline">
                <p class="control is-expanded">
                    <input class="input is-static" type="text"
                            value="Found {{ flights.data | length }} flight offers. Sort by:">
                </p>
                <p class="control">
                    <div class="dropdown">
                <div class="dropdown-trigger">
                    <button class="button" aria-haspopup="true" aria-controls="dropdown-menu">
                        <span id="sort-order">Price - Low to High</span>
                        <span class="icon is-small">
                            <i class="fas fa-angle-down" aria-hidden="true"></i>
                        </span>
                    </button>
                </div>
                <div class="dropdown-menu" id="dropdown-menu" role="menu">
                    <div class="dropdown-content">
                    <a href="/flights/price-wise-asc" class="dropdown-item">
                        Dropdown item
                    </a>
                    <a class="dropdown-item">
                        Other dropdown item
                    </a>
                    <a href="#" class="dropdown-item is-active">
                        Active dropdown item
                    </a>
                    <a href="#" class="dropdown-item">
                        Other dropdown item
                    </a>
                    <hr class="dropdown-divider">
                    <a href="#" class="dropdown-item">
                        With a divider
                    </a>
                    </div>
                </div>
                </div>
                </p>
            </div>
        </section>
    </article>
    <article class="container block">
        <section class="section is-primary">
            <div class="columns">
                <div class="column is-narrow is-one-quarter-mobile">
                    <button class="button is-medium unclickable circular">
                        <span class="icon is-small">
                            <i class="fa fa-plane-departure"></i>
                        </span>
                    </button>
                </div>
                <div class="column is-narrow">
                    <p class="title normal">
                        <strong class="smallcaps">
                            {{- params.originLocation[params.originLocation.index("- ")+2:] }}
                        </strong>
                        to
                        <strong class="smallcaps">
                            {{ params.destinationLocation[params.destinationLocation.index("- ")+2:] -}}
                        </strong>
                    </p>
                    <p class="subtitle is-6">
                        Departure, on {{ params.departureDate -}}
                    </p>
                </div>
            </div>
        </section>
        <section class="columns is-variable is-0 is-tablet travel-classes">
            <div class="column is-offset-half-desktop">
                <p class="p-4 {{ params.travelClass|lower }}-class">
                    <span class="">{{ params.travelClass }}</span>
                </p>
            </div>
        </section>
        {% for flight in flights.data[:10] %}
            <section class="card block">
                <div class="card-content">
                    {% set itinerary = flight.itineraries[0] %}
                    <div class="columns is-desktop is-vcentered">
                        <div class="column is-half-desktop">
                            <p class="block evenly-spaced">
                                <span class="flight-duration">
                                    {{ itinerary.duration | parse_duration | format_duration("{:%t}") }}
                                </span>
                                <span class="clickable flight-duration">
                                    Details
                                    <span class="icon is-small">
                                        <i class="fa fa-angle-down"></i>
                                    </span>
                                <span>
                            </p>
                            <article class="modal">
                                <section class="modal-background"></section>
                                <section class="modal-content">
                                    <div class="card">
                                        <div class="card-header">
                                            <div class="columns is-vcentered is-mobile">
                                                <div class="column is-narrow is-one-quarter-mobile">
                                                    <button class="button unclickable circular">
                                                        <span class="icon is-small">
                                                            <i class="fa fa-plane"></i>
                                                        </span>
                                                    </button>
                                                </div>
                                                <div class="column is-narrow">
                                                    <p class="title is-5">
                                                        <strong class="smallcaps">
                                                            Flight Details
                                                        </strong>
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="card-content">
                                            {% for segment in itinerary.segments %}
                                                <div class="columns is-multiline main-segment">
                                                    <div class="column is-one-quarter">
                                                        <p class="title mini">DEPARTURE</p>
                                                        <p class="subtitle mini">{{ segment.departure.at | parse_datetime | strftime("%a, %b %d, %Y %H:%M") }}</p>
                                                    </div>
                                                    <div class="column is-one-quarter">
                                                        <p class="title mini">FROM</p>
                                                        <p class="subtitle mini">{{ segment.departure.iataCode }}</p>
                                                    </div>
                                                    <div class="column is-one-quarter">
                                                        <p class="title mini">ARRIVAL</p>
                                                        <p class="subtitle mini">{{ segment.arrival.at | parse_datetime | strftime("%a, %b %d, %Y %H:%M") }}</p>
                                                    </div>
                                                    <div class="column is-one-quarter">
                                                        <p class="title mini">AT</p>
                                                        <p class="subtitle mini">{{ segment.arrival.iataCode }}</p>
                                                    </div>
                                                    <div class="column is-one-quarter">
                                                        <p class="title mini">FLIGHT</p>
                                                        <p class="subtitle mini">{{ segment.carrierCode }} {{ segment.number }}</p>
                                                    </div>
                                                    <div class="column is-one-quarter">
                                                        <p class="title mini">OPERATED BY</p>
                                                        <p class="subtitle mini">
                                                            {{- flights.dictionaries.carriers[segment.carrierCode] | title -}}
                                                            {% if segment.operating.carrierCode != segment.carrierCode %}
                                                                , {{ flights.dictionaries.carriers[segment.operating.carrierCode] | title }}
                                                            {% endif %}
                                                        </p>
                                                    </div>
                                                    <div class="column is-one-quarter">
                                                        <p class="title mini">DURATION</p>
                                                        <p class="subtitle mini">{{ segment.duration | parse_duration | format_duration ("{:%H %M}") }}</p>
                                                    </div>
                                                    <div class="column is-one-quarter">
                                                        <p class="title mini">AIRCRAFT</p>
                                                        <p class="subtitle mini">{{ flights.dictionaries.aircraft[segment.aircraft.code] | title }}</p>
                                                    </div>
                                                </div>
                                                {% if loop.nextitem is defined %}
                                                    {% set next_dep = loop.nextitem.departure.at | parse_datetime %}
                                                    {% set prev_arr = segment.arrival.at | parse_datetime %}
                                                    <div class="layover-segment">
                                                        <span class="icon is-small">
                                                            <i class="fa fa-clock"></i>
                                                        </span>
                                                        <span class="mini">
                                                            {{ (next_dep - prev_arr) | format_duration("{:%H %M}") }}
                                                            Layover in {{ segment.arrival.iataCode }}
                                                        </span>
                                                    </div>
                                                {% endif %}
                                            {% endfor %}
                                        </div>
                                    </div>
                                </section>
                                <button class="modal-close is-large" aria-label="close"></button>
                            </article>
                            <div class="block evenly-spaced">
                                {% set departure = itinerary.segments[0].departure.at | parse_datetime %}
                                {% set arrival = itinerary.segments[-1].arrival.at | parse_datetime %}
                                <span class="flight-time">
                                    {{ departure | strftime("%H:%M") }}
                                </span>
                                <span>

                                    <span class="flight-time">
                                        {{ arrival | strftime("%H:%M") -}}
                                    </span>
                                    <span class="flight-time is-small">
                                        {% set days = (arrival - departure).days %}
                                        {{- "({:+})".format(days) if days != 0 else "" }}
                                    </span>
                                </span>
                            </div>
                            <div class="flight-path block">
                                <div class="stop">
                                    <span>{{ itinerary.segments[0].departure.iataCode }}</span>
                                </div>
                                {% for segment in itinerary.segments %}
                                    <div class="carrier">
                                        <span>
                                            {{- segment.carrierCode }}
                                            {{ segment.number }}<br>
                                            ({{ flights.dictionaries.carriers[segment.carrierCode] | title -}})
                                        </span>
                                    </div>
                                    <div class="stop">
                                        <span>{{ segment.arrival.iataCode }}</span>
                                        {% if loop.nextitem is defined %}
                                            {% set next_dep = loop.nextitem.departure.at | parse_datetime %}
                                            {% set prev_arr = segment.arrival.at | parse_datetime %}
                                            <span class="is-uppercase has-small-text">
                                                {{ (next_dep - prev_arr) | format_duration("{:%H %M}") }}
                                            </span>
                                        {% endif %}
                                    </div>
                                    {% set prev_segment = segment %}
                                {% endfor %}
                            </div>
                        </div>
                        <div class="column">
                            <div class="columns flight-prices is-centered is-vcentered is-tablet">
                                <div class="column has-text-centered">
                                    <p class="mb-4">
                                        <span class="subtitle is-6">{{- flight.price.currency }}</span>
                                        <span class="title is-4">{{ "{:,.0f}".format(flight.price.grandTotal|float) -}}</span>
                                    </p>
                                    <p class="flight-fare clickable subtitle is-6">
                                        <span class="icon is-small">
                                            <i class="fa fa-file-invoice-dollar"></i>
                                        </span>
                                        <span>Fare Details<span>
                                    </p>
                                    <article class="modal">
                                        <section class="modal-background"></section>
                                        <section class="modal-content">
                                            <div class="card">
                                                <div class="card-header">
                                                    <div class="columns is-vcentered is-mobile">
                                                        <div class="column is-narrow is-one-quarter-mobile">
                                                            <button class="button unclickable circular">
                                                                <span class="icon is-small">
                                                                    <i class="fa fa-coins"></i>
                                                                </span>
                                                            </button>
                                                        </div>
                                                        <div class="column is-narrow">
                                                            <p class="title is-5">
                                                                <strong class="smallcaps">
                                                                    Fare Details
                                                                </strong>
                                                            </p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="card-content">
                                                    <div class="columns is-multiline fare-segment">
                                                        <div class="column is-12">
                                                            <p class="title mini is-spaced">BASE FARE</p>
                                                            <p class="subtitle mini">+ {{ flight.price.currency }} {{ "{:,.0f}".format(flight.price.base|float) }}</p>
                                                        </div>
                                                        <div class="column is-12 total">
                                                            <p class="title mini is-spaced">FARE WITH TAXES</p>
                                                            <p class="subtitle mini">{{ flight.price.currency }} {{ "{:,.0f}".format(flight.price.total|float) }}</p>
                                                        </div>
                                                        {% for fee in flight.price.fees %}
                                                            <div class="column is-12">
                                                                <p class="title mini is-spaced">{{ fee.type }} FEES</p>
                                                                <p class="subtitle mini">+ {{ flight.price.currency }} {{ "{:,.0f}".format(fee.amount|float) }}</p>
                                                            </div>
                                                        {% endfor %}
                                                        <div class="column is-12 total">
                                                            <p class="title is-6 is-spaced">GRAND TOTAL FARE</p>
                                                            <p class="subtitle is-6">{{ flight.price.currency }} {{ "{:,.0f}".format(flight.price.grandTotal|float) }}</p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </section>
                                        <button class="modal-close is-large" aria-label="close"></button>
                                    </article>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        {% endfor %}
    </article>
    {% if "returnDate" in params or flights.data[0].itineraries|length > 1 %}
        <article class="container block">
            <section class="section is-primary">
                <div class="columns">
                    <div class="column is-narrow">
                        <button class="button is-medium unclickable circular">
                            <span class="icon is-small">
                                <i class="fa fa-plane-departure fa-flip-horizontal"></i>
                            </span>
                        </button>
                    </div>
                    <div class="column is-narrow">
                        <p class="title normal">
                            <strong class="smallcaps">
                                {{ params.destinationLocation[params.destinationLocation.index("- ")+2:] -}}
                            </strong>
                            to
                            <strong class="smallcaps">
                                {{- params.originLocation[params.originLocation.index("- ")+2:] }}
                            </strong>
                        </p>
                        <p class="subtitle is-6">
                            Return, on {{ params.returnDate -}}
                        </p>
                    </div>
                </div>
            </section>
            <section class="columns is-variable is-0 is-tablet travel-classes">
                <div class="column is-offset-half-desktop">
                    <p class="p-4 {{ params.travelClass|lower }}-class">
                        <span class="">{{ params.travelClass }}</span>
                    </p>
                </div>
            </section>
            {% for flight in flights.data[:10] %}
                <section class="card block">
                    <div class="card-content">
                        {% set itinerary = flight.itineraries[1] %}
                        <div class="columns is-desktop is-vcentered">
                            <div class="column is-half-desktop">
                                <p class="block evenly-spaced">
                                    <span class="flight-duration">
                                        {{ itinerary.duration | parse_duration | format_duration("{:%t}") }}
                                    </span>
                                    <span class="clickable flight-duration">
                                        Details
                                        <span class="icon is-small">
                                            <i class="fa fa-angle-down"></i>
                                        </span>
                                    <span>
                                </p>
                                <article class="modal">
                                    <section class="modal-background"></section>
                                    <section class="modal-content">
                                        <div class="card">
                                            <div class="card-header">
                                                <div class="columns is-vcentered is-mobile">
                                                    <div class="column is-narrow is-one-quarter-mobile">
                                                        <button class="button unclickable circular">
                                                            <span class="icon is-small">
                                                                <i class="fa fa-plane"></i>
                                                            </span>
                                                        </button>
                                                    </div>
                                                    <div class="column is-narrow">
                                                        <p class="title is-5">
                                                            <strong class="smallcaps">
                                                                Flight Details
                                                            </strong>
                                                        </p>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="card-content">
                                                {% for segment in itinerary.segments %}
                                                    <div class="columns is-multiline main-segment">
                                                        <div class="column is-one-quarter">
                                                            <p class="title mini">DEPARTURE</p>
                                                            <p class="subtitle mini">{{ segment.departure.at | parse_datetime | strftime("%a, %b %d, %Y %H:%M") }}</p>
                                                        </div>
                                                        <div class="column is-one-quarter">
                                                            <p class="title mini">FROM</p>
                                                            <p class="subtitle mini">{{ segment.departure.iataCode }}</p>
                                                        </div>
                                                        <div class="column is-one-quarter">
                                                            <p class="title mini">ARRIVAL</p>
                                                            <p class="subtitle mini">{{ segment.arrival.at | parse_datetime | strftime("%a, %b %d, %Y %H:%M") }}</p>
                                                        </div>
                                                        <div class="column is-one-quarter">
                                                            <p class="title mini">AT</p>
                                                            <p class="subtitle mini">{{ segment.arrival.iataCode }}</p>
                                                        </div>
                                                        <div class="column is-one-quarter">
                                                            <p class="title mini">FLIGHT</p>
                                                            <p class="subtitle mini">{{ segment.carrierCode }} {{ segment.number }}</p>
                                                        </div>
                                                        <div class="column is-one-quarter">
                                                            <p class="title mini">OPERATED BY</p>
                                                            <p class="subtitle mini">
                                                                {{- flights.dictionaries.carriers[segment.carrierCode] | title -}}
                                                                {% if segment.operating.carrierCode != segment.carrierCode %}
                                                                    , {{ flights.dictionaries.carriers[segment.operating.carrierCode] | title }}
                                                                {% endif %}
                                                            </p>
                                                        </div>
                                                        <div class="column is-one-quarter">
                                                            <p class="title mini">DURATION</p>
                                                            <p class="subtitle mini">{{ segment.duration | parse_duration | format_duration ("{:%H %M}") }}</p>
                                                        </div>
                                                        <div class="column is-one-quarter">
                                                            <p class="title mini">AIRCRAFT</p>
                                                            <p class="subtitle mini">{{ flights.dictionaries.aircraft[segment.aircraft.code] | title }}</p>
                                                        </div>
                                                    </div>
                                                    {% if loop.nextitem is defined %}
                                                        {% set next_dep = loop.nextitem.departure.at | parse_datetime %}
                                                        {% set prev_arr = segment.arrival.at | parse_datetime %}
                                                        <div class="layover-segment">
                                                            <span class="icon is-small">
                                                                <i class="fa fa-clock"></i>
                                                            </span>
                                                            <span class="mini">
                                                                {{ (next_dep - prev_arr) | format_duration("{:%H %M}") }}
                                                                Layover in {{ segment.arrival.iataCode }}
                                                            </span>
                                                        </div>
                                                    {% endif %}
                                                {% endfor %}
                                            </div>
                                        </div>
                                    </section>
                                    <button class="modal-close is-large" aria-label="close"></button>
                                </article>
                                <div class="block evenly-spaced">
                                    {% set departure = itinerary.segments[0].departure.at | parse_datetime %}
                                    {% set arrival = itinerary.segments[-1].arrival.at | parse_datetime %}
                                    <span class="flight-time">
                                        {{ departure | strftime("%H:%M") }}
                                    </span>
                                    <span>

                                        <span class="flight-time">
                                            {{ arrival | strftime("%H:%M") -}}
                                        </span>
                                        <span class="flight-time is-small">
                                            {% set days = (arrival - departure).days %}
                                            {{- "({:+})".format(days) if days != 0 else "" }}
                                        </span>
                                    </span>
                                </div>
                                <div class="flight-path block">
                                    <div class="stop">
                                        <span>{{ itinerary.segments[0].departure.iataCode }}</span>
                                    </div>
                                    {% for segment in itinerary.segments %}
                                        <div class="carrier">
                                            <span>
                                                {{- segment.carrierCode }}
                                                {{ segment.number }}<br>
                                                ({{ flights.dictionaries.carriers[segment.carrierCode] | title -}})
                                            </span>
                                        </div>
                                        <div class="stop">
                                            <span>{{ segment.arrival.iataCode }}</span>
                                            {% if loop.nextitem is defined %}
                                                {% set next_dep = loop.nextitem.departure.at | parse_datetime %}
                                                {% set prev_arr = segment.arrival.at | parse_datetime %}
                                                <span class="is-uppercase has-small-text">
                                                    {{ (next_dep - prev_arr) | format_duration("{:%H %M}") }}
                                                </span>
                                            {% endif %}
                                        </div>
                                        {% set prev_segment = segment %}
                                    {% endfor %}
                                </div>
                            </div>
                            <div class="column">
                                <div class="columns flight-prices is-centered is-vcentered is-tablet">
                                    <div class="column has-text-centered">
                                        <p class="mb-4">
                                            <span class="subtitle is-6">{{- flight.price.currency }}</span>
                                            <span class="title is-4">{{ "{:,.0f}".format(flight.price.grandTotal|float) -}}</span>
                                        </p>
                                        <p class="flight-fare clickable subtitle is-6">
                                            <span class="icon is-small">
                                                <i class="fa fa-file-invoice-dollar"></i>
                                            </span>
                                            <span>Fare Details<span>
                                        </p>
                                        <article class="modal">
                                            <section class="modal-background"></section>
                                            <section class="modal-content">
                                                <div class="card">
                                                    <div class="card-header">
                                                        <div class="columns is-vcentered is-mobile">
                                                            <div class="column is-narrow is-one-quarter-mobile">
                                                                <button class="button unclickable circular">
                                                                    <span class="icon is-small">
                                                                        <i class="fa fa-coins"></i>
                                                                    </span>
                                                                </button>
                                                            </div>
                                                            <div class="column is-narrow">
                                                                <p class="title is-5">
                                                                    <strong class="smallcaps">
                                                                        Fare Details
                                                                    </strong>
                                                                </p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="card-content">
                                                        <div class="columns is-multiline fare-segment">
                                                            <div class="column is-12">
                                                                <p class="title mini is-spaced">BASE FARE</p>
                                                                <p class="subtitle mini">+ {{ flight.price.currency }} {{ "{:,.0f}".format(flight.price.base|float) }}</p>
                                                            </div>
                                                            <div class="column is-12 total">
                                                                <p class="title mini is-spaced">FARE WITH TAXES</p>
                                                                <p class="subtitle mini">{{ flight.price.currency }} {{ "{:,.0f}".format(flight.price.total|float) }}</p>
                                                            </div>
                                                            {% for fee in flight.price.fees %}
                                                                <div class="column is-12">
                                                                    <p class="title mini is-spaced">{{ fee.type }} FEES</p>
                                                                    <p class="subtitle mini">+ {{ flight.price.currency }} {{ "{:,.0f}".format(fee.amount|float) }}</p>
                                                                </div>
                                                            {% endfor %}
                                                            <div class="column is-12 total">
                                                                <p class="title is-6 is-spaced">GRAND TOTAL FARE</p>
                                                                <p class="subtitle is-6">{{ flight.price.currency }} {{ "{:,.0f}".format(flight.price.grandTotal|float) }}</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </section>
                                            <button class="modal-close is-large" aria-label="close"></button>
                                        </article>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            {% endfor %}
        </article>
    {% endif %}
{% endblock flights_block %}

{% block scripts_block %}
    <script src="/static/scripts/flights.js"></script>
{% endblock scripts_block %}